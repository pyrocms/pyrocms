/**************************************
    Webutler V2.1 - www.webutler.de
    Copyright (c) 2008 - 2011
    Autor: Sven Zinke
    Free for any use
    Lizenz: GPL
**************************************/

CKEDITOR.dialog.add('gmap',function(a){function b(d,e){var f='',g=d.split(';');for(var h=0;h<g.length;h++){var i=g[h].split(':');if(CKEDITOR.tools.trim(i[0]).toLowerCase()==e){f=parseInt(CKEDITOR.tools.trim(i[1]));break;}}return f;};function c(d,e){var f='var '+e+' = ',g=d.indexOf(f),h=d.substr(g+f.length,d.length),i=h.substr(0,h.indexOf(';'));i.replace(/\'/g,'');return CKEDITOR.tools.trim(i);};return{title:a.lang.googlemaps.wintitle,minWidth:450,minHeight:350,onOk:function(){if(this.getValueOf('info','marker')!=true){alert(a.lang.googlemaps.setmarker);return false;}var d=iframeWindow.lat,e=iframeWindow.lng,f=iframeWindow.map.getZoom(),g=this.getValueOf('info','mapHeight'),h=this.getValueOf('info','mapWidth'),i=document.getElementById('mapinfowin_'+a.name).getElementsByTagName('textarea')[0].value;i=i.replace(/\r/g,'').replace(/\n/g,' ');var j='<div class="googlemapsframe" style="width: '+h+'px; height: '+g+'px">\n'+'<scr'+'ipt type="text/javascript">\n'+'  /*<![CDATA[*/\n'+"    document.writeln('<scr' + 'ipt type=\"text/javascript\" src=\"http://maps.google.com/maps/api/js?sensor=false\"></scr' + 'ipt>' +\n"+"    '    <scr' + 'ipt type=\"text/javascript\">' +\n"+"    '    /*<![CDATA[*/' +\n"+"    '    (function() {' +\n"+"    '        if (window.addEventListener)' +\n"+"    '            window.addEventListener(\\'load\\', initgooglemap, false);' +\n"+"    '        else' +\n"+"    '            window.attachEvent(\\'onload\\', initgooglemap);' +\n"+"    '    })();' +\n"+"    '    function initgooglemap() {' +\n"+"    '        var mapZoom = "+f+";' +\n"+"    '        var mapLat = "+d+";' +\n"+"    '        var mapLng = "+e+";' +\n"+"    '        var mapInfo = \\'"+i+"\\';' +\n"+"    '        var latlng = new google.maps.LatLng(mapLat,mapLng);' +\n"+"    '        var myOptions = {' +\n"+"    '            zoom: mapZoom,' +\n"+"    '            center: latlng,' +\n"+"    '            mapTypeId: google.maps.MapTypeId.ROADMAP' +\n"+"    '        };' +\n"+"    '        var map = new google.maps.Map(document.getElementById(\\'googlemapcanvas\\'), myOptions);' +\n"+"    '        var marker = new google.maps.Marker({' +\n"+"    '            position: latlng,' +\n"+"    '            map: map' +\n"+"    '        });' +\n"+"    '        marker.setMap(map);' +\n"+"    '        var infowindow = new google.maps.InfoWindow({' +\n"+"    '            content: mapInfo' +\n"+"    '        });' +\n"+"    '        infowindow.open(map, marker);' +\n"+"    '        google.maps.event.addListener(marker, \\'click\\', function() {' +\n"+"    '            infowindow.open(map, marker);' +\n"+"    '        });' +\n"+"    '    };' +\n"+"    '    /*]]>*/' +\n"+"    '    </scr' + 'ipt>' +\n"+'    \'    <div id="googlemapcanvas" style="width: 100%; height: 100%"></div>\');\n'+'  /*]]>*/\n'+'</scr'+'ipt>\n'+'</div>';
a.insertHtml(j);},contents:[{id:'info',label:'',style:'overflow: hidden',elements:[{type:'vbox',padding:0,children:[{type:'hbox',widths:['10%','100%','10%'],children:[{type:'html',html:a.lang.googlemaps.address+':'},{type:'text',id:'adresse',label:'',style:'width: 100%','default':a.lang.googlemaps.typeaddress,onClick:function(){this.setValue('');}},{type:'button',id:'suche',label:a.lang.googlemaps.search,onClick:function(){iframeWindow.showAddress(a.lang.googlemaps.addressnotfound);}}]},{id:'iframe',label:'googlemapframe',expand:true,type:'iframe',src:CKEDITOR.plugins.getPath('gmap')+'dialogs/gmap.htm',width:'450',height:'280',style:'padding: 10px 0px 10px 0px',onContentLoad:function(){var d=document.getElementById(this._.frameId);iframeWindow=d.contentWindow;var e=CKEDITOR.dialog.getCurrent(),f=a.getSelection().getSelectedElement();if(f){var g=a.restoreRealElement(f);if(g.getAttribute('class')=='googlemapsframe'){var h=b(g.getAttribute('style'),'width')||'100',i=b(g.getAttribute('style'),'height')||'100';e.setValueOf('info','mapHeight',i);e.setValueOf('info','mapWidth',h);e.setValueOf('info','marker',true);var j=decodeURIComponent(g.getHtml()).toString(),k=c(j,'mapInfo');k=k.substr(2,k.length-4);document.getElementById('mapinfowin_'+a.name).getElementsByTagName('textarea')[0].value=k;var l=c(j,'mapZoom'),m=c(j,'mapLat'),n=c(j,'mapLng');iframeWindow.zoomer=parseInt(l);iframeWindow.infowintext=k;iframeWindow.lat=parseFloat(m);iframeWindow.lng=parseFloat(n);iframeWindow.reloadMap();}}}},{type:'hbox',widths:['0px','50px','40px','30px','35px','30px','35px','160px'],children:[{type:'html',html:'<div id="mapinfowin_'+a.name+'" style="display: none" class="infowin">'+'<textarea class="infoeditor"></textarea>'+'<img class="infobutton" src="'+CKEDITOR.plugins.getPath('gmap')+"dialogs/close.gif\" onclick=\"if(this.parentNode.getElementsByTagName('textarea')[0].value != '') { if(confirm('"+a.lang.googlemaps.confirm+"')) { this.parentNode.getElementsByTagName('textarea')[0].value = ''; iframeWindow.infowintext = ''; iframeWindow.setInfoWin(); } else { return false; } } this.parentNode.style.display='none';\" title=\""+a.lang.googlemaps.cancel+'" />'+'<img class="infobutton" src="'+CKEDITOR.plugins.getPath('gmap')+"dialogs/ok.gif\" onclick=\"iframeWindow.infowintext = this.parentNode.getElementsByTagName('textarea')[0].value; iframeWindow.setInfoWin(); this.parentNode.style.display='none';\" title=\""+a.lang.googlemaps.accept+'" style="margin-top: 35px" />'+'</div>'},{id:'marker',type:'checkbox',label:' '+a.lang.googlemaps.marker,onClick:function(){iframeWindow.setMarker();
}},{type:'button',id:'infotext',label:a.lang.googlemaps.text,onClick:function(){this.getElement().getDocument().getById('mapinfowin_'+a.name).setStyle('display','block');document.getElementById('mapinfowin_'+a.name).getElementsByTagName('textarea')[0].focus();}},{type:'html',html:a.lang.googlemaps.width+':'},{type:'text',id:'mapWidth',label:'',style:'width: 35px','default':'500',required:true,validate:CKEDITOR.dialog.validate.notEmpty(a.lang.googlemaps.nowidth)},{type:'html',html:a.lang.googlemaps.height+':'},{type:'text',id:'mapHeight',label:'',style:'width: 35px','default':'300',required:true,validate:CKEDITOR.dialog.validate.notEmpty(a.lang.googlemaps.noheight)},{type:'html',html:'&nbsp;'}]}]}]}]};});
