/*
Copyright (c) 2003-2011, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

CKEDITOR.dialog.add('colordialog',function(a){var b=CKEDITOR.dom.element,c=CKEDITOR.document,d=a.lang.colordialog,e,f={type:'html',html:'&nbsp;'},g;function h(){c.getById(t).removeStyle('background-color');e.getContentElement('picker','selectedColor').setValue('');g&&g.removeAttribute('aria-selected');g=null;};function i(v){var w=v.data.getTarget(),x;if(w.getName()=='td'&&(x=w.getChild(0).getHtml())){g=w;g.setAttribute('aria-selected',true);e.getContentElement('picker','selectedColor').setValue(x);}};function j(v){v=v.replace(/^#/,'');for(var w=0,x=[];w<=2;w++)x[w]=parseInt(v.substr(w*2,2),16);var y=0.2126*x[0]+0.7152*x[1]+0.0722*x[2];return '#'+(y>=165?'000':'fff');};var k,l;function m(v){!v.name&&(v=new CKEDITOR.event(v));var w=!/mouse/.test(v.name),x=v.data.getTarget(),y;if(x.getName()=='td'&&(y=x.getChild(0).getHtml())){n(v);w?k=x:l=x;if(w){x.setStyle('border-color',j(y));x.setStyle('border-style','dotted');}c.getById(r).setStyle('background-color',y);c.getById(s).setHtml(y);}};function n(v){var w=!/mouse/.test(v.name),x=w&&k;if(x){var y=x.getChild(0).getHtml();x.setStyle('border-color',y);x.setStyle('border-style','solid');}if(!(k||l)){c.getById(r).removeStyle('background-color');c.getById(s).setHtml('&nbsp;');}};function o(v){var w=v.data,x=w.getTarget(),y,z,A=w.getKeystroke(),B=a.lang.dir=='rtl';if(x.is('table')&&A<41&&A>36){x=x.$.rows[0].cells[0];x.focus();w.preventDefault();return;}switch(A){case 38:if(y=x.getParent().getPrevious()){z=y.getChild([x.getIndex()]);z.focus();}w.preventDefault();break;case 40:if(y=x.getParent().getNext()){z=y.getChild([x.getIndex()]);if(z&&z.type==1)z.focus();}w.preventDefault();break;case 32:case 13:i(v);w.preventDefault();break;case B?37:39:if(z=x.getNext()){if(z.type==1){z.focus();w.preventDefault(true);}}else if(y=x.getParent().getNext()){z=y.getChild([0]);if(z&&z.type==1){z.focus();w.preventDefault(true);}}break;case B?39:37:if(z=x.getPrevious()){z.focus();w.preventDefault(true);}else if(y=x.getParent().getPrevious()){z=y.getLast();z.focus();w.preventDefault(true);}break;default:return;}};function p(){u=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+d.options+'"'+' role="grid" style="border-collapse:separate;" cellspacing="0">'+'<caption class="cke_voice_label">'+d.options+'</caption>'+'<tbody role="presentation"></tbody></table>');u.on('mouseover',m);u.on('mouseout',n);u.on('keydown',o);var v=['00','33','66','99','cc','ff'];function w(B,C){for(var D=B;D<B+3;D++){var E=new b(u.$.insertRow(-1));
E.setAttribute('role','row');for(var F=C;F<C+3;F++)for(var G=0;G<6;G++)x(E.$,'#'+v[F]+v[G]+v[D]);}};function x(B,C){var D=new b(B.insertCell(-1));D.setAttribute('class','ColorCell');D.setAttribute('tabIndex',-1);D.setAttribute('role','gridcell');D.on('keydown',o);D.on('click',i);D.on('focus',m);D.on('blur',n);D.setStyle('background-color',C);D.setStyle('border','1px solid '+C);D.setStyle('width','14px');D.setStyle('height','14px');var E=q('color_table_cell');D.setAttribute('aria-labelledby',E);D.append(CKEDITOR.dom.element.createFromHtml('<span id="'+E+'" class="cke_voice_label">'+C+'</span>',CKEDITOR.document));};w(0,0);w(3,0);w(0,3);w(3,3);var y=u.$.insertRow(-1);for(var z=0;z<6;z++)x(y,'#'+v[z]+v[z]+v[z]);for(var A=0;A<12;A++)x(y,'#000000');};var q=function(v){return CKEDITOR.tools.getNextId()+'_'+v;},r=q('hicolor'),s=q('hicolortext'),t=q('selhicolor'),u;p();return{title:d.title,minWidth:360,minHeight:220,onLoad:function(){e=this;},onHide:function(){k=g=null;},contents:[{id:'picker',label:d.title,accessKey:'I',elements:[{type:'hbox',padding:0,widths:['70%','10%','30%'],children:[{type:'html',html:'<div></div>',onLoad:function(){CKEDITOR.document.getById(this.domId).append(u);},focus:function(){(k||this.getElement().getFirst()).focus();}},f,{type:'vbox',padding:0,widths:['70%','5%','25%'],children:[{type:'html',html:'<span>'+d.highlight+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+r+'" style="border: 1px solid; height: 74px; width: 74px;"></div>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+s+'">&nbsp;</div><span>'+d.selected+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+t+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:'text',label:d.selected,labelStyle:'display:none',id:'selectedColor',style:'width: 74px',onChange:function(){try{c.getById(t).setStyle('background-color',this.getValue());}catch(v){h();}}},f,{type:'button',id:'clear',style:'margin-top: 5px',label:d.clear,onClick:h}]}]}]}]};});
